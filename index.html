<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ³ç¢‡è¿·è¹¤ï¼šå±±åŸå¾©ç”¦è¡Œå‹•</title>
    <style>
        /* CSS æ¨£å¼ */
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            /* ä½¿ç”¨èƒŒæ™¯åœ–ï¼ˆè«‹æ”¾ç½®åœ–ç‰‡æ–¼ assets/bg.jpgï¼‰ä¸¦åŠ ä¸ŠåŠé€æ˜æ·±è‰²é®ç½©ä»¥ç¶­æŒæ–‡å­—èˆ‡å¡ç‰‡å¯è®€æ€§ */
            background: linear-gradient(rgba(10,10,10,0.6), rgba(25    ,200,200,0.5)), url('assets/bg.jpg') center/cover fixed no-repeat;
            color: #e0e0e0; /* æ·ºç°æ–‡å­— */
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }
        #game-container {
            width: 100%;
                max-width: 100%; /* è®“å…§å±¤é…åˆå¤–å±¤å¯¬åº¦ */
            background-color: rgba(25,25,25,0.8); /* åŠé€æ˜æ·±ç°å®¹å™¨ */
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            padding: 30px;
        }
        /* å¤–å±¤åŒ…å±¤ï¼šåŠé€æ˜é‚Šæ¡†èˆ‡å…§è·ï¼Œè®“æ•´é«”æ›´æœ‰å±¤æ¬¡ */
        #outer-wrap {
            width: 100%;
                max-width: 1000px; /* ç¸®å°å¯¬åº¦ï¼ˆå¯å†èª¿æ•´ï¼‰ */
            display: flex;
            justify-content: center;
            padding: 15px; /* èˆ‡ body çš„é–“è· */
            box-sizing: border-box;
            background-color: rgba(0,0,0,0.3); /* åŠé€æ˜å¤–æ¡†é®ç½© */
            -webkit-backdrop-filter: blur(2px);
            backdrop-filter: blur(2px);
            border-radius: 5px;
            margin: 0 10px;
            border: 1px solid rgba(255,255,255,0.03);
        }
 
        h1 {
            color: #64b5f6; /* æ·ºè—è‰²æ¨™é¡Œ */
            text-align: center;
            border-bottom: 3px solid #ffb74d;
            padding-bottom: 10px;
        }
        h2 {
            color: #ffb74d; /* æ©˜é»ƒè‰²å‰¯æ¨™é¡Œ */
            margin-top: 25px;
        }
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .start-screen, .final-screen, #select-role-screen {
            text-align: center;
        }
        .btn {
            background-color: #ffb74d; /* æ·±è—æŒ‰éˆ• */
            color: white;
            border: none;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .btn:hover:not(.disabled) {
            background-color: #1565c0;
        }
        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* è§’è‰²é¸æ“‡å¡ç‰‡ */
        #role-selection-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .role-card {
            border: 2px solid 	#FF8000;
            padding: 15px;
            border-radius: 8px;
            background-color: #3a3a3a; /* æ·±ç°å¡ç‰‡ */
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: left;
            color: #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        .role-card-image {
            flex-shrink: 0;
            width: 120px;
            height: 140px;
            border-radius: 6px;
            overflow: hidden;
            background-color: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .role-card-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .role-card-content {
            flex: 1;
        }
        .role-card:hover:not(.selected) {
            background-color: #4a4a4a;
            transform: translateY(-3px);
        }
        .role-card.selected {
            border-color: #ffb74d;
            background-color: #4a3a1a;
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.5);
        }
        .role-card h3 {
            color: #64b5f6;
            border-bottom: 1px dashed #64b5f6;
            margin-top: 0;
            padding-bottom: 5px;
        }

        /* éŠæˆ²ç•«é¢æ¨£å¼ */
        .question-box {
            border: 1px solid #444;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            background-color: #3a3a3a; /* æ·±ç°å•é¡Œæ¡† */
            color: #e0e0e0;
        }
        .options-list {
            list-style: none;
            padding: 0;
        }
        .options-list li {
            background-color: #454545;
            margin: 8px 0;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: #e0e0e0;
        }
        .options-list li:hover:not(.disabled) {
            background-color: #555555;
        }
        .options-list li.correct-answer { background-color: #2e7d32; border: 1px solid #4caf50; color: #ffffff; }
        .options-list li.wrong-answer { background-color: #c62828; border: 1px solid #f44336; color: #ffffff; }
        .ability-box {
            background-color: #3a3a2a;
            border: 1px solid #666633;
            padding: 10px;
            margin-top: 15px;
            border-radius: 5px;
            text-align: center;
            color: #e0e0e0;
        }
        .ability-btn {
            background-color: #ffb74d;
            color: #333;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }
        #message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            color: #ffffff;
        }
        .fragment {
            color: #ffb74d;
            font-weight: bold;
            font-size: 1.1em;
        }
        #player-role-display {
            background-color: #2a3a2a;
            border: 1px solid #4caf50;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: left; /* ç¢ºä¿å…§å®¹é å·¦å°é½Š */
            color: #e0e0e0;
        }
        .specialty-q-hint {
            font-size: 0.9em; 
            color: #81c784;
            margin-top: 5px;
        }
        .specialty-q-current {
            color: #ffb74d;
            font-weight: bold;
        }
        /* éŠæˆ²ä¸­çš„è§’è‰²ç«‹ç¹ªï¼ˆå·¦ä¸‹è§’ï¼‰ */
        #game-character-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 180px;
            height: 240px;
            background-color: rgba(45, 45, 45, 0.9);
            border: 2px solid #64b5f6;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        #game-character-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 5px;
        }
        /* ä¸‹ä¸€é¡ŒæŒ‰éˆ•å®¹å™¨ */
        #next-q-container {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
        }
        /* é€šé—œæ·¡å…¥ overlay */
        #victory-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.0); /* é€æ˜ï¼Œå…§å®¹æœ¬èº«æœƒå‘ˆç¾ */
            z-index: 9999;
            pointer-events: auto;
        }
        #victory-overlay .content {
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            transform: scale(0.95);
            opacity: 0;
        }
        @keyframes victoryFadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to   { opacity: 1; transform: scale(1); }
        }
        @keyframes victoryFadeOut {
            from { opacity: 1; transform: scale(1); }
            to   { opacity: 0; transform: scale(1.05); }
        }
        #victory-overlay.visible { display: flex; }
        #victory-overlay.visible .content {
            animation: victoryFadeIn 0.9s ease-out forwards;
        }
        #victory-overlay.hiding .content {
            animation: victoryFadeOut 0.7s ease-in forwards;
        }
    </style>
</head>
<body>
    <div id="outer-wrap">

    <div id="game-container">
        <h1>
            <!-- å°‡ä½ çš„ logo åœ–ç‰‡æ”¾åœ¨ assets è³‡æ–™å¤¾ï¼Œå‘½åç‚º logo.png æˆ–ä¿®æ”¹ä¸‹æ–¹ src è·¯å¾‘ -->
            <img id="site-logo" src="assets/logo.png" alt="çŸ³ç¢‡è¿·è¹¤ï¼šå±±åŸå¾©ç”¦è¡Œå‹•" style="max-width: 360px; width: 100%; height: auto; display: block; margin: 0 auto;">
        </h1>
        <p><em>â€” åµæŸ¥å±±åŸçš„ç’°å¢ƒå±æ©Ÿ â€”</em></p>

        <div id="start-screen" class="screen">
            <h2>ğŸ“œ åŠ‡æƒ…å•Ÿå‹•</h2>
            <p style="padding: 15px; border: 1px dashed #999;">
                <strong>ã€ŒçŸ³ç¢‡ï¼Œä¸åªæ˜¯èŒ¶é„‰ï¼Œå®ƒæ›¾æ˜¯é–ƒè€€çš„ç…¤ç¤¦ä¹‹åŸã€‚ç„¶è€Œï¼Œæ·˜é‡‘å¤¢é†’ï¼Œç’°å¢ƒç•™ä¸‹äº†å‚·ç—•ã€‚ä½ ï¼Œæ˜¯ã€å±±åŸå¾©ç”¦è¡Œå‹•çµ„ã€çš„æˆå“¡ï¼Œä½ çš„ä»»å‹™æ˜¯éŸ¿æ‡‰æ–‡å±±æºªç™¼å‡ºçš„ã€ç•°å¸¸è¨Šè™Ÿã€ã€‚è¨Šè™Ÿä¸­å¤¾é›œè‘—èˆŠæ™‚ç¤¦å·¥çš„æš—èªï¼šã€æ¬²æ·¨æ°´è„ˆï¼Œé ˆè§£èˆŠå¤¢ã€‚ã€ä½ å¿…é ˆè¿½æº¯æ–‡å±±ç…¤ç¤¦çš„èˆˆè¡°æ­·ç¨‹ï¼Œæ‰¾å‡ºå½±éŸ¿æºªæµç”Ÿæ…‹çš„ã€ä¸‰å¤§ç—…ç¶ã€ï¼Œæ‹¼æ¹Šå‡ºå®Œæ•´çš„ç”Ÿæ…‹ä¿®å¾©è¡Œå‹•æ–¹æ¡ˆï¼ã€</strong>
            </p>
            <p><strong>ä»»å‹™ç›®æ¨™ï¼š</strong> é€šéä¸‰é“é—œå¡ï¼Œæ”¶é›†ã€ä¿®å¾©è¡Œå‹•ç¢ç‰‡ã€‘ï¼Œè§£é–æœ€çµ‚çš„å¯¦åœ°è¡Œå‹•ã€‚</p>
            <button class="btn" onclick="showRoleSelection()">é–‹å§‹åµæŸ¥è¡Œå‹•</button>
        </div>

        <div id="select-role-screen" class="screen">
            <h2>ğŸ‘¤ é¸æ“‡ä½ çš„è§’è‰²èº«ä»½</h2>
            <p>è«‹é¸æ“‡ä½ åœ¨æ­¤æ¬¡ã€Œå±±åŸå¾©ç”¦è¡Œå‹•çµ„ã€ä¸­å°‡æ‰®æ¼”çš„èº«ä»½ï¼Œä½ çš„è§’è‰²èƒ½åŠ›å°‡åœ¨é—œéµæ™‚åˆ»åŠ©ä½ ä¸€è‡‚ä¹‹åŠ›ã€‚</p>
            <div id="role-selection-grid">
                </div>
            <button class="btn disabled" id="confirm-role-btn" onclick="confirmRoleSelection()">ç¢ºèªé¸æ“‡ï¼Œé€²å…¥ç¬¬ä¸€é—œ &raquo;</button>
        </div>

        <div id="game-screen" class="screen">
            <div id="player-role-display">
                </div>

            <h2 id="stage-title">é—œå¡æ¨™é¡Œ</h2>
            <p><strong>é€²åº¦ï¼š</strong> <span id="progress-text"></span></p>

            <div id="question-area" class="question-box">
                <p><strong>å•è™Ÿ</strong> <span id="current-q-index"></span></p>
                <p id="question-text"></p>
                <ul id="options-list" class="options-list">
                    </ul>
                <div id="ability-ui" class="ability-box">
                    <strong>è§’è‰²å°ˆé•·ï¼š</strong>
                    <span id="current-ability"></span>
                    <button class="ability-btn" onclick="useAbility()">ä½¿ç”¨å°ˆé•· (æœ¬é—œé™ç”¨ä¸€æ¬¡)</button>
                    <p style="font-size: 0.9em; margin: 5px 0 0;">(æ³¨: ä½¿ç”¨å¾Œï¼Œå°‡ç²å¾—é¡å¤–æç¤ºæˆ–æ’é™¤éŒ¯èª¤é¸é …ã€‚)</p>
                </div>
            </div>

            <div id="message"></div>
            <div id="next-q-container">
                <button class="btn disabled" id="next-q-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ &raquo;</button>
            </div>
        </div>

        <div id="final-screen" class="screen">
            <h2>ğŸ‰ é—œå¡å››ï¼šè¡Œå‹• - ä¸è¦‹å¤©ä¸‹çš„è½‰å‹è—åœ–</h2>
            <p><strong>æ­å–œï¼</strong>ä½ å·²æˆåŠŸåµæŸ¥ä¸¦æ”¶é›†åˆ°å®Œæ•´çš„<span class="fragment">ã€è½‰å‹æ–¹æ¡ˆã€‘</span>ã€<span class="fragment">ã€ä¿®å¾©æŠ€è¡“ã€‘</span>èˆ‡<span class="fragment">ã€å”åŠ›ç¶²çµ¡ã€‘</span>ä¸‰å¼µç¢ç‰‡ï¼Œæ‹¼æ¹Šå‡º**ã€ŒçŸ³ç¢‡å¾©ç”¦è—åœ–ã€**ï¼</p>

            <div style="background-color: #e9f7e9; color: #000; padding: 20px; border: 2px solid #38761d; border-radius: 10px; margin-top: 20px;">
                <h3>ğŸ”¥ æœ€çµ‚ä»»å‹™æŒ‡ä»¤ï¼ˆå¯¦åœ°æ‡‰ç”¨ï¼‰</h3>
                <p>ç¾åœ¨ï¼Œä½ å¿…é ˆå‰å¾€å…·æ­·å²æ„ç¾©çš„<strong>çŸ³ç¢‡ä¸è¦‹å¤©è¡—</strong>ï¼ˆæˆ–é€²è¡Œè™›æ“¬è§€å¯Ÿï¼‰ï¼Œè§€å¯Ÿè©²å ´åŸŸçš„ç©ºé–“è¨­è¨ˆæ™ºæ…§ï¼Œä¸¦å°‡ä½ è¨­è¨ˆçš„ã€ŒçŸ³ç¢‡å¾©ç”¦è—åœ–ã€å…·é«”åŒ–ï¼š</p>
                <p><strong>è¨­è¨ˆä¸€å€‹çµåˆéºå€æ´»åŒ–ã€ç”Ÿæ…‹å¾©è‚²ã€ç¤¾å€å”åŠ›å…ƒç´ çš„éŠæˆ²åŒ–è¡Œå‹•æ–¹æ¡ˆ</strong>ï¼ˆä¾‹å¦‚ï¼šä¸€å€‹å¯¦åœ°å°è¦½è·¯ç·šåœ–ã€ä¸€å€‹ç”Ÿæ…‹æ•™è‚²å±•æ¿è¨­è¨ˆã€æˆ–ä¸€ä»½ç¤¾å€å€¡è­°å ±å‘Šï¼‰ã€‚</p>
                <p>å°‡æœ€çµ‚æˆæœé€éç¶²è·¯å¹³å°å…¬é–‹åˆ†äº«ï¼Œç™¼ä½ˆåœ°æ–¹è¡Œå‹•å€¡è­°ï¼Œå®Œæˆå±±åŸå¾©ç”¦è¡Œå‹•ï¼</p>
            </div>
            <p style="margin-top: 20px; font-style: italic;">æ„Ÿè¬ä½ ç‚ºçŸ³ç¢‡å±±åŸèˆ‡æ–‡å±±æºªæ‰€åšçš„åŠªåŠ›ï¼</p>
        </div>

    </div>

    <!-- é€šé—œæ·¡å…¥å‹•ç•« overlay -->
    <div id="victory-overlay" aria-hidden="true">
        <div class="content" role="dialog" aria-modal="true">
            <h2 style="margin:0 0 10px; font-size:28px; color:#ffb74d;">é€šé—œï¼ä»»å‹™å®Œæˆ</h2>
            <p style="margin:0 0 12px; color:#fff;">ä½ å·²æ”¶é›†å®Œæ•´ç¢ç‰‡ï¼ŒçŸ³ç¢‡å±±åŸè¿å‘å¾©ç”¦ã€‚</p>
            <!-- å¯æ”¹ç‚ºåœ–ç‰‡æˆ–å½±ç‰‡å…ƒç´ ï¼ˆè‹¥æœ‰ overlay.webm å¯æ”¾å…¥ï¼‰ -->
            <div style="margin-top:8px; opacity:0.95;">
                <img src="assets/winner.gif" alt="é€šé—œå‹•ç•«" style="max-width:560px; width:100%; height:auto; display:block; margin:0 auto;" onerror="this.style.display='none'">
            </div>
        </div>
    </div>

    <!-- éŠæˆ²ä¸­çš„è§’è‰²ç«‹ç¹ªé¡¯ç¤º -->
    </div>
    <div id="game-character-display" style="display: none;">
    </div>

    <script>
        // JavaScript é‚è¼¯
        const gameData = {
            roles: {
                'æºªå“¥': { key: 'æºªå“¥', name: 'ğŸ” ç”Ÿæ…‹èª¿æŸ¥å“¡-æºªå“¥', ability: 'ã€æ°´è„ˆè¨ºæ–·ã€‘æ’é™¤å…©å€‹éŒ¯èª¤é¸é …', field: 'æºªæµç”Ÿæ…‹èˆ‡æ±¡æŸ“æº', specialtyQ: ['2-3', '2-5', '3-3'] },
                'é˜¿æ–‡': { key: 'é˜¿æ–‡', name: 'ğŸ“œ ç¤¾å€è¨˜éŒ„è€…-é˜¿æ–‡', ability: 'ã€æ™‚å…‰è¨ªè«‡ã€‘æ’é™¤å…©å€‹éŒ¯èª¤é¸é …', field: 'ç¤¦å·¥æ–‡åŒ–èˆ‡èšè½è¨˜æ†¶', specialtyQ: ['1-3', '3-1', '1-4'] },
                'é˜¿è·¯': { key: 'é˜¿è·¯', name: 'ğŸ—ºï¸ åœ°æ–¹å°è¦½å“¡-é˜¿è·¯', ability: 'ã€éºå€é‡å»ºã€‘æ’é™¤å…©å€‹éŒ¯èª¤é¸é …', field: 'éºå€æ´»åŒ–èˆ‡åœ°è²Œè®Šé·', specialtyQ: ['1-2', '3-4', '3-5'] },
                'å°é›…': { key: 'å°é›…', name: 'ğŸ’¡ ç”Ÿæ…‹è¨­è¨ˆå¸«-å°é›…', ability: 'ã€æ°¸çºŒåˆ†æã€‘æ’é™¤å…©å€‹éŒ¯èª¤é¸é …', field: 'æ°¸çºŒç™¼å±•èˆ‡ç¤¾å€æŒ¯èˆˆ', specialtyQ: ['1-1', '1-5', '2-2'] }
            },
            stages: [
                {
                    id: 0,
                    title: 'é—œå¡ä¸€ï¼šç—…ç¶ 1ï¸âƒ£ - æ·˜é‡‘å¤¢çš„é½è• (ç”¢æ¥­çš„å‚·ç—•)',
                    fragment: 'ã€è½‰å‹æ–¹æ¡ˆã€‘ç¢ç‰‡ 1/3',
                    questions: [
                        { q: '1-1. å°ç£ç…¤ç¤¦ç”¢æ¥­åœ¨ 1970-1980 å¹´ä»£æ²’è½ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ä»€éº¼ï¼Ÿ', options: ['A. ç¤¦å·¥äººå£å¤–ç§»ã€‚', 'B. æŠ€è¡“ç„¡æ³•çªç ´ã€‚', 'C. å…¨çƒèƒ½æºçµæ§‹æ”¹è®Šï¼Œé€²å£ç…¤ç‚­æˆæœ¬æ›´ä½ã€‚', 'D. æ”¿ç­–ç¦æ­¢ç™¼é›»ç”¨ç…¤ã€‚'], answer: 'C', abilityQ: false },
                        { q: '1-2. æ–‡å±±ç…¤ç¤¦éºå€ä½œç‚ºæ­·å²è¨˜æ†¶ä¿å­˜èˆ‡è½‰å‹æ´»åŒ–çš„ç©ºé–“ï¼Œæœ€ç¬¦åˆä¸‹åˆ—å“ªä¸€ç¨®æ¦‚å¿µï¼Ÿ', options: ['A. å•†æ¥­è³¼ç‰©ä¸­å¿ƒã€‚', 'B. é«˜ç§‘æŠ€ç ”ç©¶åœ’å€ã€‚', 'C. ç”Ÿæ…‹åšç‰©é¤¨æˆ–æ–‡åŒ–åŸºåœ°ã€‚', 'D. è±ªè¯æ—…éŠåº¦å‡æ‘ã€‚'], answer: 'C', abilityQ: false },
                        { q: '1-3. ä¾æ“šç¤¦å·¥çš„å£è¿°æ­·å²ï¼Œç•¶æ™‚çŸ³ç¢‡ç…¤ç¤¦ç”¢å€çš„ç¤¦å·¥å®¿èˆæœ€å¸¸ä½¿ç”¨çš„å»ºç¯‰ææ–™æ˜¯ï¼Ÿ', options: ['A. ç¾ä»£é‹¼ç­‹æ··å‡åœŸã€‚', 'B. ç•¶åœ°çš„çŸ³æå’Œæœ¨æ–™æ­å»ºçš„ç°¡æ˜“å·¥å¯®ã€‚', 'C. é€²å£çš„ç»ç’ƒçº–ç¶­ã€‚', 'D. ç²¾ç·»çš„ç´…ç£šç“¦æˆ¿ã€‚'], answer: 'B', abilityQ: false },
                        { q: '1-4. ç…¤ç¤¦è½å¹•å¾Œï¼Œç¤¦å€èšè½é¢è‡¨çš„æœ€å¤§ç¤¾æœƒè­°é¡Œæ˜¯ï¼Ÿ', options: ['A. è§€å…‰å®¢éå¤šï¼Œç’°å¢ƒé«’äº‚ã€‚', 'B. ç”¢æ¥­éåº¦é›†ä¸­ï¼Œç¶“æ¿Ÿæ³¡æ²«åŒ–ã€‚', 'C. äººå£å¤–æµèˆ‡çµæ§‹è€åŒ–ã€‚', 'D. åœŸåœ°ç„¡æ³•é€²è¡Œè¾²æ¥­é–‹ç™¼ã€‚'], answer: 'C', abilityQ: false },
                        { q: '1-5. æ¢ç©¶ç…¤ç¤¦ç”¢æ¥­çš„èˆˆç››éç¨‹ï¼Œå…¶æŠ€è¡“æ¼”é€²ä¸»è¦å¸¶å‹•äº†å“ªå€‹é ˜åŸŸçš„ç™¼å±•ï¼Ÿ', options: ['A. ç²¾å¯†é›»å­å·¥æ¥­ã€‚', 'B. è’¸æ±½å‹•åŠ›èˆ‡éµè·¯é‹è¼¸ã€‚', 'C. é†«ç™‚ç”ŸæŠ€ç”¢æ¥­ã€‚', 'D. èˆªå¤ªé£›è¡ŒæŠ€è¡“ã€‚'], answer: 'B', abilityQ: true } 
                    ]
                },
                {
                    id: 1,
                    title: 'é—œå¡äºŒï¼šç—…ç¶ 2ï¸âƒ£ - æºªæµçš„é»ƒè‰²è­¦å ± (ç’°å¢ƒçš„æ¯’å®³)',
                    fragment: 'ã€ä¿®å¾©æŠ€è¡“ã€‘ç¢ç‰‡ 2/3',
                    questions: [
                        { q: '2-1. ç…¤ç¤¦é–‹æ¡å°æºªæµæ°´è³ªæœ€å¸¸è¦‹çš„æ±¡æŸ“é¡å‹ï¼Œé™¤äº†é‡é‡‘å±¬å¤–ï¼Œé‚„åŒ…å«å“ªä¸€ç¨®ï¼Ÿ', options: ['A. å¡‘è† å¾®ç²’æ±¡æŸ“ã€‚', 'B. æœ‰æ©Ÿè‚¥æ–™æ®˜ç•™ã€‚', 'C. è¼»å°„ç‰©è³ªæ±¡æŸ“ã€‚', 'D. é…¸æ€§å»¢æ°´æˆ–ç…¤æ¸£ç€æ¿¾æ°´ã€‚'], answer: 'D', abilityQ: false },
                        { q: '2-2. æ–‡å±±æºªçš„æ£²åœ°å¤šæ¨£æ€§æ¢å¾©ï¼Œå°å“ªå€‹SDGç›®æ¨™å¯¦è¸æœ€ç›´æ¥ç›¸é—œï¼Ÿ', options: ['A. SDG 8 (å°Šåš´å·¥ä½œ)ã€‚', 'B. SDG 15 (é™¸åœ°ç”Ÿæ…‹)ã€‚', 'C. SDG 4 (å„ªè³ªæ•™è‚²)ã€‚', 'D. SDG 6 (æ·¨æ°´èˆ‡è¡›ç”Ÿ)ã€‚'], answer: 'B', abilityQ: false },
                        { q: '2-3. æ ¹æ“šæ°´è„ˆè¨ºæ–·çµæœï¼Œæºªæµç”Ÿæ…‹å¾©è‚²çš„ç›®æ¨™ä¹‹ä¸€æ˜¯æ¢å¾©æ£²åœ°å¤šæ¨£æ€§ã€‚é€™ä¸»è¦æŒ‡è¦è®“æºªæµä¸­å…·å‚™å“ªç¨®ç‰¹å¾µçš„å€åŸŸï¼Ÿ', options: ['A. åªæœ‰ç­†ç›´çš„æ°´æ³¥æ²³å²¸ã€‚', 'B. åªæœ‰å–®ä¸€æ·±åº¦èˆ‡æµé€Ÿçš„å€åŸŸã€‚', 'C. å…·æœ‰å¤šæ¨£çš„åº•è³ªã€æ°´æ·±å’Œæµé€Ÿçš„å€åŸŸã€‚', 'D. å°ˆé–€è¨­ç«‹çš„è§€è³é­šé¤Šæ®–å€ã€‚'], answer: 'C', abilityQ: true }, 
                        { q: '2-4. ç¤¦å€å‘¨é‚Šå¤§é‡å †ç©çš„å»¢åœŸèˆ‡ç…¤æ¸£ï¼Œåœ¨ä¸‹é›¨æ™‚æœ€å®¹æ˜“é€ æˆæºªæµçš„å“ªç¨®ç’°å¢ƒå•é¡Œï¼Ÿ', options: ['A. æº«å®¤æ•ˆæ‡‰ã€‚', 'B. æ³¥æ²™æ·¤ç©èˆ‡æ°´è³ªæ¿åº¦å¢åŠ ã€‚', 'C. è‡­æ°§å±¤ç ´æ´ã€‚', 'D. æºªæ°´æº«åº¦æ€¥åŠ‡ä¸‹é™ã€‚'], answer: 'B', abilityQ: false },
                        { q: '2-5. åœ¨çŸ³ç¢‡æºªæµç”Ÿæ…‹ä¸­ï¼Œä¸‹åˆ—å“ªä¸€ç¨®ç”Ÿç‰©å¸¸è¢«è¦–ç‚ºæ°´è³ªå„ªè‰¯çš„ç’°å¢ƒæŒ‡æ¨™ç‰©ç¨®ï¼Ÿ', options: ['A. æ±¡æŸ“è€å—æ€§é«˜çš„é¯‰é­šã€‚', 'B. å°æ°´è³ªè¦æ±‚é«˜çš„çŸ³æ–‘æˆ–æ°´ç”Ÿæ˜†èŸ²ã€‚', 'C. æ£²æ¯æ–¼é«’æ°´æºçš„èŸ‘è‚ã€‚', 'D. å–œæ­¡é«˜é¹½åº¦çš„æµ·é³¥ã€‚'], answer: 'B', abilityQ: false }
                    ]
                },
                {
                    id: 2,
                    title: 'é—œå¡ä¸‰ï¼šç—…ç¶ 3ï¸âƒ£ - äººå¿ƒçš„æ–·è£‚å¸¶ (ç¤¾å€çš„å›°å¢ƒ)',
                    fragment: 'ã€å”åŠ›ç¶²çµ¡ã€‘ç¢ç‰‡ 3/3',
                    questions: [
                        { q: '3-1. åœ¨ç¤¦å·¥èšè½çš„å£è¿°è¿½æº¯ä¸­ï¼Œè€ç¤¦å·¥æ™‚å¸¸æåŠçš„ã€Œç¤¦å·¥ç²¾ç¥ã€æ ¸å¿ƒåƒ¹å€¼ç‚ºä½•ï¼Ÿ', options: ['A. è¿½æ±‚å€‹äººè²¡å¯Œæœ€å¤§åŒ–ã€‚', 'B. ã€Œé›ç± é¤Šé›ï¼Œå¤§å®¶å‘·é£¯ã€çš„äº’åŠ©åˆä½œç²¾ç¥ã€‚', 'C. åš´æ ¼çš„éšç´šåˆ¶åº¦ã€‚', 'D. çµ•å°æœå¾å·¥é ­å‘½ä»¤ã€‚'], answer: 'B', abilityQ: true }, 
                        { q: '3-2. åœ°æ–¹æ¨å‹•ç¤¾å€ç¸½é«”ç‡Ÿé€ ï¼Œç›®çš„æ˜¯è¦è®“å±…æ°‘ä¸»å‹•åƒèˆ‡ï¼Œä¿ƒé€²ç¤¾å€ç™¼å±•ã€‚é€™æœ€ç¬¦åˆä¸‹åˆ—å“ªé …åŸå‰‡ï¼Ÿ', options: ['A. è³‡è¨Šå£Ÿæ–·ã€‚', 'B. é€éå…¬å¹³åƒèˆ‡ï¼Œå¯¦ç¾åœ°æ–¹æ²»ç†ã€‚', 'C. ç¶“æ¿Ÿè‡³ä¸Šã€‚', 'D. åƒ…ç”±å°‘æ•¸èè‹±é ˜å°ã€‚'], answer: 'B', abilityQ: false },
                        { q: '3-3. çŸ³ç¢‡é™¤äº†ç…¤ç¤¦ä»¥å¤–ï¼Œæ­·å²ä¸Šä¹Ÿæ›¾æ˜¯å“ªä¸€ç¨®çŸ¥åç”¢æ¥­çš„ç”¢åœ°ï¼Ÿ', options: ['A. ç¨»ç±³æˆ–ç”˜è”—ç¨®æ¤ã€‚', 'B. å¤§èæŸ“æ–™æˆ–èŒ¶è‘‰ã€‚', 'C. æ¼æ¥­æˆ–æ°´ç”¢é¤Šæ®–ã€‚', 'D. é«˜å±±æ°´æœç¨®æ¤ã€‚'], answer: 'B', abilityQ: false },
                        { q: '3-4. ç‚ºäº†å¸å¼•é’å¹´è¿”é„‰æˆ–ã€Œé—œä¿‚äººå£ã€åƒèˆ‡ï¼Œéºå€æ´»åŒ–è¨­è¨ˆæ‡‰è€ƒæ…®ç´å…¥ä¸‹åˆ—å“ªç¨®å…ƒç´ ï¼Ÿ', options: ['A. åƒ…å±•ç¤ºè€èˆŠæ–‡ç‰©ã€‚', 'B. èå…¥äº’å‹•å¼ã€å‰µæ„è¨­è¨ˆçš„å±•è¦½æˆ–æ´»å‹•ç©ºé–“ã€‚', 'C. å®Œå…¨ç¦æ­¢å¤–äººé€²å…¥åƒè§€ã€‚', 'D. å°‡æ‰€æœ‰è€èˆŠå»ºç¯‰æ‹†é™¤ã€‚'], answer: 'B', abilityQ: false },
                        { q: '3-5. ã€Œä¸è¦‹å¤©è¡—ã€é€™ç¨®èšè½æ™¯è§€çš„å½¢æˆï¼Œä¸»è¦èˆ‡å“ªä¸€é …åœ°åŸŸé™åˆ¶æˆ–éœ€æ±‚æœ‰é—œï¼Ÿ', options: ['A. æˆ°çˆ­æ™‚æœŸç‚ºäº†èº²é¿ç©ºè¥²ã€‚', 'B. å±±å€åœ°å½¢ã€æ°£å€™æˆ–ç‚ºäº†å•†æ¥­é¿é›¨ã€‚', 'C. ç¾ä»£å»ºç¯‰ç¾å­¸çš„è¿½æ±‚ã€‚', 'D. ç‚ºäº†é˜²æ­¢å‹•ç‰©å…¥ä¾µã€‚'], answer: 'B', abilityQ: false }
                    ]
                }
            ]
        };

        let gameState = {
            currentStage: 0,
            currentQuestion: 0,
            fragmentsCollected: 0,
            score: 0,
            abilitiesUsed: { 0: false, 1: false, 2: false },
            isQuestionLocked: false,
            selectedRoleKey: null 
        };

        const elements = {
            startScreen: document.getElementById('start-screen'),
            gameScreen: document.getElementById('game-screen'),
            finalScreen: document.getElementById('final-screen'),
            selectRoleScreen: document.getElementById('select-role-screen'),
            stageTitle: document.getElementById('stage-title'),
            progressText: document.getElementById('progress-text'),
            questionText: document.getElementById('question-text'),
            currentQIndex: document.getElementById('current-q-index'),
            optionsList: document.getElementById('options-list'),
            abilityUI: document.getElementById('ability-ui'),
            currentAbility: document.getElementById('current-ability'),
            message: document.getElementById('message'),
            nextQBtn: document.getElementById('next-q-btn'),
            playerRoleDisplay: document.getElementById('player-role-display'),
            roleSelectionGrid: document.getElementById('role-selection-grid'),
            confirmRoleBtn: document.getElementById('confirm-role-btn')
        };

        // é¡¯ç¤ºæŒ‡å®šç•«é¢
        function showScreen(screenId) {
            elements.startScreen.style.display = 'none';
            elements.gameScreen.style.display = 'none';
            elements.finalScreen.style.display = 'none';
            elements.selectRoleScreen.style.display = 'none';
            document.getElementById(screenId).style.display = 'block';
            
            // åªåœ¨éŠæˆ²ç•«é¢æ™‚é¡¯ç¤ºè§’è‰²ç«‹ç¹ª
            const characterDisplay = document.getElementById('game-character-display');
            if (screenId === 'game-screen') {
                characterDisplay.style.display = 'flex';
            } else {
                characterDisplay.style.display = 'none';
            }

            // åœ¨é¡¯ç¤ºæœ€çµ‚ç•«é¢æ™‚è§¸ç™¼æ·¡å…¥é€šé—œå‹•ç•«
            if (screenId === 'final-screen') {
                showVictoryOverlay();
            }
        }

        // é¡¯ç¤º/éš±è—é€šé—œ overlay
        function showVictoryOverlay() {
            const overlay = document.getElementById('victory-overlay');
            if (!overlay) return;
            overlay.classList.remove('hiding');
            overlay.classList.add('visible');
            overlay.setAttribute('aria-hidden', 'false');

            // é»æ“Šå¯ç«‹åˆ»é—œé–‰
            overlay.onclick = () => hideVictoryOverlay();

            // è‡ªå‹•åœ¨ 3.2 ç§’å¾Œæ·¡å‡º
            setTimeout(() => {
                hideVictoryOverlay();
            }, 3200);
        }

        function hideVictoryOverlay() {
            const overlay = document.getElementById('victory-overlay');
            if (!overlay) return;
            overlay.classList.add('hiding');
            overlay.setAttribute('aria-hidden', 'true');
            // ç­‰å¾…å‹•ç•«çµæŸå†å®Œå…¨éš±è—
            setTimeout(() => {
                overlay.classList.remove('visible');
                overlay.classList.remove('hiding');
                overlay.style.display = 'none';
            }, 750);
        }

        // é¡¯ç¤ºè§’è‰²é¸æ“‡ç•«é¢
        function showRoleSelection() {
            showScreen('select-role-screen');
            renderRoleSelection();
        }

        // æ¸²æŸ“è§’è‰²é¸æ“‡å¡ç‰‡
        function renderRoleSelection() {
            elements.roleSelectionGrid.innerHTML = '';

            const roleImages = {
                'æºªå“¥': '1.png',
                'é˜¿æ–‡': '2.png',
                'é˜¿è·¯': '3.png',
                'å°é›…': '4.png'
            };

            Object.values(gameData.roles).forEach(role => {
                const card = document.createElement('div');
                card.className = 'role-card';
                card.dataset.key = role.key; 
                card.innerHTML = `
                    <div class="role-card-image">
                        <img src="assets/${roleImages[role.key]}" alt="${role.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22140%22%3E%3Crect fill=%22%23555%22 width=%22120%22 height=%22140%22/%3E%3Ctext x=%2260%22 y=%2270%22 fill=%22%23999%22 text-anchor=%22middle%22 font-size=%2214%22%3Eåœ–ç‰‡æœªè¼‰å…¥%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="role-card-content">
                        <h3>${role.name}</h3>
                        <p><strong>å°ˆé•·é ˜åŸŸï¼š</strong>${role.field}</p>
                        <p><strong>å°ˆé•·èƒ½åŠ›ï¼š</strong>${role.ability}</p>
                    </div>
                `;
                card.onclick = (e) => {
                    // å–æ¶ˆæ‰€æœ‰é¸ä¸­çš„ç‹€æ…‹
                    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
                    
                    // è¨­å®šé¸ä¸­ç‹€æ…‹
                    e.currentTarget.classList.add('selected');
                    elements.confirmRoleBtn.classList.remove('disabled');
                };
                elements.roleSelectionGrid.appendChild(card);
            });

            // èª¿æ•´ç¢ºèªæŒ‰éˆ•çš„é»æ“Šäº‹ä»¶
            elements.confirmRoleBtn.onclick = () => {
                const selectedCard = document.querySelector('.role-card.selected');
                if (selectedCard) {
                    // ä¿®æ­£ï¼šç›´æ¥å„²å­˜ key å€¼
                    gameState.selectedRoleKey = selectedCard.dataset.key; 
                    startGame();
                }
            };
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            gameState.currentStage = 0;
            gameState.currentQuestion = 0;
            gameState.fragmentsCollected = 0;
            gameState.score = 0;
            gameState.abilitiesUsed = { 0: false, 1: false, 2: false };
            showScreen('game-screen');
            
            // é¡¯ç¤ºè§’è‰²ç«‹ç¹ª
            displayCharacterImage();
            
            renderGame();
        }

        // é¡¯ç¤ºè§’è‰²ç«‹ç¹ªçš„å‡½å¼
        function displayCharacterImage() {
            const roleImages = {
                'æºªå“¥': '1.png',
                'é˜¿æ–‡': '2.png',
                'é˜¿è·¯': '3.png',
                'å°é›…': '4.png'
            };
            
            const characterDisplay = document.getElementById('game-character-display');
            const imageName = roleImages[gameState.selectedRoleKey];
            
            characterDisplay.innerHTML = `
                <img src="assets/${imageName}" alt="${gameState.selectedRoleKey}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22180%22 height=%22240%22%3E%3Crect fill=%22%23444%22 width=%22180%22 height=%22240%22/%3E%3Ctext x=%2290%22 y=%22120%22 fill=%22%23999%22 text-anchor=%22middle%22 font-size=%2214%22%3Eåœ–ç‰‡æœªè¼‰å…¥%3C/text%3E%3C/svg%3E'">
            `;
            characterDisplay.style.display = 'flex';
        }

        // æ¸²æŸ“éŠæˆ²ç•«é¢
        function renderGame() {
            if (gameState.currentStage >= gameData.stages.length) {
                return showScreen('final-screen');
            }

            const stage = gameData.stages[gameState.currentStage];
            const currentQ = stage.questions[gameState.currentQuestion];

            elements.stageTitle.textContent = `${stage.title} (æ”¶é›† ${stage.fragment})`;
            elements.progressText.innerHTML = `å·²æ”¶é›† <span class="fragment">${gameState.fragmentsCollected}</span> / 3 å¼µç¢ç‰‡ | æ­£åœ¨å›ç­” ${gameState.currentQuestion + 1} / ${stage.questions.length} é¡Œ`;
            elements.currentQIndex.textContent = `ç¬¬ ${currentQ.q.split('.')[0]} é¡Œï¼š`; 
            elements.questionText.textContent = currentQ.q.substring(currentQ.q.indexOf('.') + 1).trim(); 
            elements.message.textContent = '';
            elements.message.style.backgroundColor = 'transparent';
            elements.nextQBtn.classList.add('disabled');
            gameState.isQuestionLocked = false;

            renderPlayerRoleDisplay();
            renderOptions(currentQ);
            renderAbilityUI(stage, currentQ);
        }

        // æ¸²æŸ“ç©å®¶è§’è‰²é¡¯ç¤º (å·²æ–°å¢å°ˆæ¥­é¡Œç›®æç¤º)
        function renderPlayerRoleDisplay() {
            const role = gameData.roles[gameState.selectedRoleKey];

            elements.playerRoleDisplay.innerHTML = `
                <p><strong>ä½ çš„èº«ä»½ï¼š</strong> ${role.name}</p>
                <p><strong>ä½ çš„å°ˆé•·ï¼š</strong> ${role.ability}</p>
                <p class="specialty-q-hint">ä½ çš„å°ˆæ¥­é¡Œç›®ç·¨è™Ÿ (å¯å•Ÿç”¨èƒ½åŠ›)ï¼š<span class="specialty-q-current">${role.specialtyQ.join(', ')}</span></p>
            `;
        }

        // æ¸²æŸ“é¸é …
        function renderOptions(question, optionsOverride = null) {
            const options = optionsOverride || question.options;
            elements.optionsList.innerHTML = '';

            options.forEach((option, index) => {
                const li = document.createElement('li');
                li.textContent = option;
                li.dataset.index = index;
                li.onclick = () => checkAnswer(option.charAt(0), li);
                if (gameState.isQuestionLocked) {
                    li.classList.add('disabled');
                }
                elements.optionsList.appendChild(li);
            });
        }

        // æª¢æŸ¥ç­”æ¡ˆ... (ç•¥)

        // æ¸²æŸ“èƒ½åŠ› UI (æ ¸å¿ƒä¿®æ­£é»)
        function renderAbilityUI(stage, currentQ) {
            const abilityBtn = elements.abilityUI.querySelector('.ability-btn');
            const role = gameData.roles[gameState.selectedRoleKey];
            
            // æª¢æŸ¥ç•¶å‰é¡Œç›®æ˜¯å¦ç‚ºç©å®¶è§’è‰²çš„å°ˆæ¥­é¡Œ
            const questionNumber = currentQ.q.split('.')[0]; 
            const isSpecialtyQ = role.specialtyQ.includes(questionNumber);

            elements.currentAbility.textContent = role.ability;

            if (gameState.abilitiesUsed[stage.id]) {
                abilityBtn.textContent = 'æœ¬é—œèƒ½åŠ›å·²ä½¿ç”¨';
                abilityBtn.classList.add('disabled');
            } else if (isSpecialtyQ) {
                // åœ¨ç©å®¶å°ˆé•·çš„é¡Œç›®ä¸Šå•Ÿç”¨æŒ‰éˆ•
                abilityBtn.textContent = `ä½¿ç”¨ã€${role.name.split('-')[0].trim()}ã€‘å°ˆé•· (æœ¬é—œé™ç”¨ä¸€æ¬¡)`;
                abilityBtn.classList.remove('disabled');
            } else {
                // å¦‚æœä¸æ˜¯å°ˆæ¥­é¡Œç›®ï¼Œç¦ç”¨æŒ‰éˆ•
                abilityBtn.textContent = `éå°ˆé•·é¡Œ (${questionNumber})ï¼Œæš«ç„¡æ³•ä½¿ç”¨`;
                abilityBtn.classList.add('disabled');
            }
        }

        // ä½¿ç”¨è§’è‰²èƒ½åŠ›
        function useAbility() {
            const stage = gameData.stages[gameState.currentStage];
            if (gameState.abilitiesUsed[stage.id] || gameState.isQuestionLocked) return;

            const currentQ = stage.questions[gameState.currentQuestion];
            const role = gameData.roles[gameState.selectedRoleKey];
            
            const questionNumber = currentQ.q.split('.')[0];
            if (!role.specialtyQ.includes(questionNumber)) {
                alert(`é€™ä¸æ˜¯ã€${role.name}ã€‘çš„å°ˆæ¥­é¡Œç›®ï¼Œç„¡æ³•æä¾›å”åŠ©ï¼`);
                return;
            }

            // åŸ·è¡Œèƒ½åŠ›æ•ˆæœï¼šæ’é™¤å…©å€‹éŒ¯èª¤é¸é …
            const correct = currentQ.answer;
            const originalOptions = currentQ.options;
            let incorrectOptions = originalOptions.filter(opt => opt.charAt(0) !== correct);
            
            let removedCount = 0;
            const newOptions = [...originalOptions];

            while (removedCount < 2 && incorrectOptions.length > 0) {
                const randomIndex = Math.floor(Math.random() * incorrectOptions.length);
                const optionToRemove = incorrectOptions[randomIndex];
                
                const optionIndexInNewOptions = newOptions.indexOf(optionToRemove);
                if (optionIndexInNewOptions > -1) {
                    newOptions.splice(optionIndexInNewOptions, 1);
                    removedCount++;
                }
                
                incorrectOptions.splice(randomIndex, 1);
            }

            gameState.abilitiesUsed[stage.id] = true;
            renderOptions(currentQ, newOptions);
            renderAbilityUI(stage, currentQ);
            
            elements.message.textContent = `ğŸ’¡ è§’è‰²èƒ½åŠ›ã€${role.ability}ã€‘å·²ä½¿ç”¨ï¼Œå·²æ’é™¤å…©å€‹éŒ¯èª¤é¸é …ï¼è«‹åœ¨å‰©ä¸‹çš„é¸é …ä¸­ä½œç­”ã€‚`;
            elements.message.style.backgroundColor = '#ffffcc';
        }

        // ä¸‹ä¸€é¡Œæˆ–ä¸‹ä¸€é—œ
        function nextQuestion() {
            if (!gameState.isQuestionLocked) return; // å¿…é ˆå…ˆä½œç­”

            gameState.currentQuestion++;

            const stage = gameData.stages[gameState.currentStage];

            if (gameState.currentQuestion >= stage.questions.length) {
                // é—œå¡å®Œæˆï¼Œç™¼æ”¾ç¢ç‰‡
                gameState.fragmentsCollected++;
                alert(`æ­å–œå®Œæˆã€${stage.title}ã€‘ï¼\nä½ ç²å¾—äº† ${stage.fragment}ï¼\nå³å°‡é€²å…¥ä¸‹ä¸€é—œã€‚`);

                gameState.currentStage++;
                gameState.currentQuestion = 0;
            }
            
            renderGame();
        }
        
        // æª¢æŸ¥ç­”æ¡ˆçš„å‡½å¼ (ç•¥)
        function checkAnswer(selectedOption, liElement) {
            if (gameState.isQuestionLocked) return;

            const stage = gameData.stages[gameState.currentStage];
            const currentQ = stage.questions[gameState.currentQuestion];
            const isCorrect = (selectedOption === currentQ.answer);

            gameState.isQuestionLocked = true;
            elements.nextQBtn.classList.remove('disabled');

            Array.from(elements.optionsList.children).forEach(item => {
                item.classList.add('disabled');
                if (item.textContent.charAt(0) === currentQ.answer) {
                    item.classList.add('correct-answer');
                }
            });

            if (isCorrect) {
                gameState.score++;
                elements.message.textContent = 'âœ… æ­£ç¢ºï¼åµæŸ¥é †åˆ©ï¼Œç²å¾—é—œéµç·šç´¢ã€‚';
                elements.message.style.backgroundColor = '#d4edda';
                elements.message.style.color = '#000';
            } else {
                liElement.classList.add('wrong-answer');
                elements.message.textContent = `âŒ éŒ¯èª¤ï¼ä½ é¸äº† ${selectedOption}ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${currentQ.answer}ã€‚è«‹ç¹¼çºŒåŠªåŠ›ã€‚`;
                elements.message.style.backgroundColor = '#f8d7da';
                elements.message.style.color = '#000';
            }
        }


        // åˆå§‹åŒ–éŠæˆ²
        showScreen('start-screen');
    </script>

</body>
</html>
